{"version":3,"sources":["../src/block-crowdfunding-ring.js"],"names":["wp","data","ServerSideRenderer","blocks","updateCategory","registerBlockType","blockEditor","Button","ColorPalette","HTML","InnerBlocks","InspectorControls","Placeholder","components","TextControl","PanelBody","SVG","G","Path","Polygon","Rect","Circle","title","pronamic_crowdfunding_ring","icon","category","attributes","target","type","value","default","raised","contributions","color","supports","edit","setAttributes","className","clientId","onChangeTarget","updateProgress","updateDetails","onChangeRaised","onChangeContributions","onChangeColor","recursiveUpdateInnerBlocks","blockType","parentBlock","attr","innerBlocks","forEach","block","name","dispatch","updateBlockAttributes","select","getBlocksByClientId","parseFloat","Math","floor","list","term","amount","colors","inspectorControls","label_target","label_raised","label_contributions","TEMPLATE","width","classes","save"],"mappings":"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","sourcesContent":["/* globals pronamic_crowdfunding_ring */\nconst { data, ServerSideRenderer } = wp;\nconst { updateCategory, registerBlockType } = wp.blocks;\nconst { Button, ColorPalette, HTML, InnerBlocks, InspectorControls, Placeholder } = wp.blockEditor;\nconst { TextControl, PanelBody } = wp.components;\nconst { SVG, G, Path, Polygon, Rect, Circle } = wp.components;\n\n( function () {\n\t'use strict';\n\n\t/**\n\t * Register crowdfunding ring block type.\n\t *\n\t * @param string name     Block name.\n\t * @param object settings Block settings.\n\t *\n\t * @return WPBlock        Block if registered successfully, otherwise \"undefined\".\n\t */\n\tregisterBlockType( 'pronamic-pay/crowdfunding-ring', {\n\t\ttitle: pronamic_crowdfunding_ring.title,\n\t\ticon: 'marker',\n\t\tcategory: 'pronamic-pay',\n\n\t\t// Attributes.\n\t\tattributes: {\n\t\t\ttarget: {\n\t\t\t\ttype: 'string',\n\t\t\t\tvalue: '0',\n\t\t\t\tdefault: '0'\n\t\t\t},\n\t\t\traised: {\n\t\t\t\ttype: 'string',\n\t\t\t\tdefault: '0'\n\t\t\t},\n\t\t\tcontributions: {\n\t\t\t\ttype: 'integer',\n\t\t\t\tdefault: 0\n\t\t\t},\n\t\t\tcolor: {\n\t\t\t\ttype: 'string',\n\t\t\t\tdefault: '#f9461c'\n\t\t\t}\n\t\t},\n\n\t\t// Feature supports.\n\t\tsupports: {\n\t\t},\n\n\t\t// Edit.\n\t\tedit( { attributes, setAttributes, className, clientId } ) {\n\t\t\tlet { target, raised, contributions, color } = attributes;\n\n\t\t\tconst onChangeTarget = ( target ) => {\n\t\t\t\tsetAttributes( { target: target } );\n\n\t\t\t\tupdateProgress();\n\t\t\t\tupdateDetails();\n\t\t\t}\n\n\t\t\tconst onChangeRaised = ( raised ) => {\n\t\t\t\tsetAttributes( { raised: raised } );\n\n\t\t\t\tupdateProgress();\n\t\t\t\tupdateDetails();\n\t\t\t}\n\n\t\t\tconst onChangeContributions = ( contributions ) => {\n\t\t\t\tsetAttributes( { contributions: contributions } );\n\n\t\t\t\tupdateDetails();\n\t\t\t}\n\n\t\t\tconst onChangeColor = ( color ) => {\n\t\t\t\tsetAttributes( { color: color } );\n\t\t\t}\n\n\t\t\tconst recursiveUpdateInnerBlocks = ( blockType, parentBlock, attr ) => {\n\t\t\t\tif ( ! parentBlock.innerBlocks ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tparentBlock.innerBlocks.forEach( ( block ) => {\n\t\t\t\t\tif ( blockType === block.name ) {\n\t\t\t\t\t\tdata.dispatch( 'core/block-editor' ).updateBlockAttributes( block.clientId, attr )\n\t\t\t\t\t}\n\n\t\t\t\t\trecursiveUpdateInnerBlocks( blockType, block, attr );\n\t\t\t\t} );\n\t\t\t};\n\n\t\t\tconst updateProgress = () => {\n\t\t\t\t// Get inner blocks of this block.\n\t\t\t\tlet block = data.select( 'core/block-editor' ).getBlocksByClientId( clientId )[0];\n\n\t\t\t\t// Calculate progress.\n\t\t\t\tlet target = parseFloat( attributes.target );\n\t\t\t\tlet raised = parseFloat( attributes.raised );\n\n\t\t\t\tif ( raised > target && 0 == target || 0 == target && 0 == raised ) {\n\t\t\t\t\ttarget = 1;\n\t\t\t\t}\n\n\t\t\t\tlet attr = {\n\t\t\t\t\tvalue: Math.floor( ( raised / target ) * 100 )\n\t\t\t\t};\n\n\t\t\t\trecursiveUpdateInnerBlocks( 'pronamic-pay/progress', block, attr );\n\t\t\t}\n\n\t\t\tconst updateDetails = () => {\n\t\t\t\t// Get inner blocks of this block.\n\t\t\t\tlet block = data.select( 'core/block-editor' ).getBlocksByClientId( clientId )[0];\n\n\t\t\t\t// Calculate progress.\n\t\t\t\tlet target = parseFloat( attributes.target );\n\t\t\t\tlet raised = parseFloat( attributes.raised );\n\n\t\t\t\tlet attr = {\n\t\t\t\t\tlist: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tterm: 'Raised',\n\t\t\t\t\t\t\tamount: raised\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tterm: 'Target',\n\t\t\t\t\t\t\tamount: target\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tterm: 'Number of contributions',\n\t\t\t\t\t\t\tvalue: attributes.contributions\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t};\n\n\t\t\t\trecursiveUpdateInnerBlocks( 'pronamic-pay/crowdfunding-details', block, attr );\n\t\t\t}\n\n\t\t\tupdateProgress();\n\t\t\tupdateDetails();\n\n\t\t\t// Inspector controls.\n\t\t\tconst colors = [\n\t\t\t\t{ name: 'orange', color: '#f9461c' },\n\t\t\t\t{ name: 'purple', color: '#6355ff' },\n\t\t\t\t{ name: 'green', color: '#2ce3be' }\n\t\t\t];\n\n\t\t\tconst inspectorControls = (\n\t\t\t\t<InspectorControls>\n\t\t\t\t\t<PanelBody>\n\t\t\t\t\t\t<TextControl\n\t\t\t\t\t\t\tlabel={ pronamic_crowdfunding_ring.label_target }\n\t\t\t\t\t\t\tvalue={ target }\n\t\t\t\t\t\t\tonChange={ onChangeTarget }\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<TextControl\n\t\t\t\t\t\t\tlabel={ pronamic_crowdfunding_ring.label_raised }\n\t\t\t\t\t\t\tvalue={ raised }\n\t\t\t\t\t\t\tonChange={ onChangeRaised }\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<TextControl\n\t\t\t\t\t\t\tlabel={ pronamic_crowdfunding_ring.label_contributions }\n\t\t\t\t\t\t\tvalue={ contributions }\n\t\t\t\t\t\t\tonChange={ onChangeContributions }\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<ColorPalette\n\t\t\t\t\t\t\tcolors={ colors }\n\t\t\t\t\t\t\tvalue={ color }\n\t\t\t\t\t\t\tonChange={ onChangeColor }\n\t\t\t\t\t\t/>\n\t\t\t\t\t</PanelBody>\n\t\t\t\t</InspectorControls>\n\t\t\t);\n\n\t\t\t// Inner blocks template.\n\t\t\tconst TEMPLATE = [\n\t\t\t\t[ 'core/columns', {}, [\n\t\t\t\t\t[ 'core/column', { width: 30 }, [\n\t\t\t\t\t\t[ 'pronamic-pay/progress', {} ]\n\t\t\t\t\t] ],\n\t\t\t\t\t[ 'core/column', { width: 70 }, [\n\t\t\t\t\t\t[ 'pronamic-pay/crowdfunding-details', {} ]\n\t\t\t\t\t] ]\n\t\t\t\t] ],\n\t\t\t];\n\n\t\t\tlet classes = className + ' ppd-block';\n\t\t\tclasses += ' ppd-block-circle';\n\n\t\t\treturn (\n\t\t\t\t<div className={ classes }>\n\t\t\t\t\t{ inspectorControls }\n\t\t\t\t\t<InnerBlocks template={ TEMPLATE } renderAppender={ false } />\n\t\t\t\t</div>\n\t\t\t);\n\t\t},\n\n\t\t// Save.\n\t\tsave( { attributes } ) {\n\t\t\treturn (\n\t\t\t\t<div className=\"ppd-block ppd-block-circle\">\n\t\t\t\t\t<InnerBlocks.Content />\n\t\t\t\t</div>\n\t\t\t);\n\t\t}\n\t} );\n\n\t/**\n\t * Pronamic Pay block category icon.\n\t */\n\tupdateCategory( 'pronamic-pay', {\n\t\ticon: (\n\t\t\t<SVG width=\"24\" height=\"24\" viewBox=\"0 0 512 512\" xmlns=\"http://www.w3.org/2000/svg\">\n\t\t\t\t<Path d=\"M256 0c141.385 0 256 114.615 256 256S397.385 512 256 512c-48.85 0-94.504-13.682-133.34-37.424L174.558 384h92.988c70.693 0 128-57.308 128-128 0-70.692-57.307-128-128-128h-46.682c-15.248 0-27.608 12.36-27.608 27.608 0 15.247 12.36 27.608 27.608 27.608h46.682c40.198 0 72.784 32.586 72.784 72.784 0 40.198-32.586 72.784-72.784 72.784H167.153c-12.869 0-23.681 8.805-26.741 20.72a28 28 0 00-.606 1.966l-30.622 114.273C43.161 419.443 0 342.762 0 256 0 114.615 114.615 0 256 0zm11.545 220.863h-65.757c-19.406 0-35.137 15.731-35.137 35.137s15.731 35.137 35.137 35.137h65.757c19.406 0 35.137-15.731 35.137-35.137s-15.731-35.137-35.137-35.137z\" fill=\"#A0A5AA\" />\n\t\t\t</SVG>\n\t\t)\n\t} );\n} )();\n"],"file":"block-crowdfunding-ring.js"}